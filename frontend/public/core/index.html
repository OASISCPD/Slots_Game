<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLOTS</title>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div>
        <div class="slots" id="slotsContainer">
            <div class="reel"></div>
            <div class="reel"></div>
            <div class="reel"></div>
        </div>
    </div>
    <script src="compiled.js"></script>
    <script>
        let clicksLeft = 3;//limite de giros
        let outcomes = []; // Arreglo para almacenar los resultados aleatorios de ganar o no ganar
        let hasWinner = false; // Variable para marcar si ya salió el ganador

        // Al cargar la página, inicializa los rodillos con índices aleatorios
        window.onload = () => {
            initRandom()
            generateRandomOutcomes()
        };

        window.addEventListener('message', (event) => {
            if (event.data.type === 'SPIN') {
                console.log('evento data', event.data.data)
                spinReels(event.data.data);
                /*    generateRandomOutcomes() */
                sendUpdateToReact()
                console.log('esta tomando bien el button')
            }
        });


        function sendUpdateToReact() {
            window.parent.postMessage({
                type: 'UPDATE_STATE',
                data: { clicksLeft, outcomes, hasWinner }
            }, '*')
        }


        // Genera un orden aleatorio para ganar/perder en 3 giros
        function generateRandomOutcomes() {
            outcomes = [false, false, true]; // Dos perdedores y un ganador
            for (let i = outcomes.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [outcomes[i], outcomes[j]] = [outcomes[j], outcomes[i]]; // Mezclar aleatoriamente los resultados
            }
        }
        // Agregar un evento de clic al botón para llamar a la función rollAll
        function spinReels(index) {
            if (clicksLeft <= 0) {
                console.log('no se puede jugar')
                return
            }
            clicksLeft--;
            const currentOutcome = outcomes[3 - clicksLeft - 1];
            console.log('current', currentOutcome)
            if (currentOutcome) {//si es verdadero que ya puede ganar
                const winIndexes = [index, index, index]
                rollAll(true, winIndexes)
            }
            else {
                const nonWinningIndexes = getNonRepeatingIndexes();
                console.log('valores erroneos para que no gane', nonWinningIndexes)
                rollAll(false, nonWinningIndexes);
            }
        };

        function getNonRepeatingIndexes() {
            const maxIndex = 8; // Define el rango máximo de los índices (0 al 8)
            const availableIndexes = Array.from({ length: maxIndex }, (_, i) => i); // Genera un arreglo de índices [0, 1, 2, ..., maxIndex - 1]
            // Mezclar los índices para obtener una lista aleatoria
            for (let i = availableIndexes.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [availableIndexes[i], availableIndexes[j]] = [availableIndexes[j], availableIndexes[i]];
            }
            console.log(availableIndexes)
            return availableIndexes.slice(0, 3); // Retorna los primeros tres índices aleatorios y diferentes
        }

        /*    // Ejemplo de uso:
           const outcome = randomOutcome();
           console.log(outcome); // Puede ser true o false, pero si es false en las dos primeras, será true en la última. */

    </script>
    <!--  <script>
        const RESOLUTIONS = {
            "335x350": 220,
            "374x350": 235,
            "350x350": 230,
            "390x350": 250,
            "414x896": 390,
            "360x800": 330,
            "390x844": 370,
            /* TABLET */
            "728x350": 280,
            /* DESKTOP */
            "984x350": 300
        };

        function getResolutionKey(width, height) {
            console.log(`Checking resolution: ${width}x${height}`);
            const closestKey = Object.keys(RESOLUTIONS).find(key => {
                const [resWidth, resHeight] = key.split('x').map(Number);
                const widthDiff = Math.abs(resWidth - width);
                const heightDiff = Math.abs(resHeight - height);
                console.log(`Comparing with key: ${key} (widthDiff: ${widthDiff}, heightDiff: ${heightDiff})`);
                return widthDiff < 10 && heightDiff < 10; // Rango de 10px
            });
            return closestKey;
        }

        function setSlotWidth() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const resolutionKey = getResolutionKey(width, height);
            const slotsContainer = document.getElementById('slotsContainer');

            if (resolutionKey) {
                slotsContainer.style.width = `${RESOLUTIONS[resolutionKey]}px`;
                console.log(`Matched resolution: ${resolutionKey}, setting width to ${RESOLUTIONS[resolutionKey]}px`);
            } else {
                // Establecer un valor por defecto si la resolución no coincide
                slotsContainer.style.width = '200px'; // Valor por defecto
                console.log(`No matching resolution found, setting default width to 400px`);
            }
        }

        // Ejecutar al cargar la página y al cambiar el tamaño de la ventana
        setSlotWidth();
        window.addEventListener('resize', setSlotWidth);
    </script> -->
    <script>
        const RESOLUTIONS = {
            "304x350": 205,
            "320x350": 205,
            "335x350": 220,
            "374x350": 235,
            "350x350": 230,
            "390x350": 250,
            "414x896": 390,
            "360x800": 330,
            "390x844": 370,
            /* TABLET */
            "500x350": 320,
            "728x350": 280,
            "780x350": 300,
            "813x350": 310,
            /* DESKTOP */
            "984x350": 300
        };

        // Valor predeterminado para tabletas
        const TABLET_WIDTH = 300; // Cambia este valor según tus necesidades

        function getResolutionKey(width, height) {
            console.log(`Checking resolution: ${width}x${height}`);

            // Verificar si está en el rango de tabletas
            if (width >= 768 && width <= 1024 && height >= 600 && height <= 800) {
                console.log(`Tablet resolution detected: ${width}x${height}`);
                return 'tablet'; // Devolvemos una clave especial para tabletas
            }

            const closestKey = Object.keys(RESOLUTIONS).find(key => {
                const [resWidth, resHeight] = key.split('x').map(Number);
                const widthDiff = Math.abs(resWidth - width);
                const heightDiff = Math.abs(resHeight - height);
                console.log(`Comparing with key: ${key} (widthDiff: ${widthDiff}, heightDiff: ${heightDiff})`);
                return widthDiff < 10 && heightDiff < 10; // Rango de 10px
            });
            return closestKey;
        }

        function setSlotWidth() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const resolutionKey = getResolutionKey(width, height);
            const slotsContainer = document.getElementById('slotsContainer');

            if (resolutionKey === 'tablet') {
                slotsContainer.style.width = `${TABLET_WIDTH}px`;
                console.log(`Matched tablet resolution, setting width to ${TABLET_WIDTH}px`);
            } else if (resolutionKey) {
                slotsContainer.style.width = `${RESOLUTIONS[resolutionKey]}px`;
                console.log(`Matched resolution: ${resolutionKey}, setting width to ${RESOLUTIONS[resolutionKey]}px`);
            } else {
                // Establecer un valor por defecto si la resolución no coincide
                slotsContainer.style.width = '250px'; // Valor por defecto
                console.log(`No matching resolution found, setting default width to 200px`);
            }
        }
        // Ejecutar al cargar la página y al cambiar el tamaño de la ventana
        setSlotWidth();
        window.addEventListener('resize', setSlotWidth);
    </script>
</body>
</html>