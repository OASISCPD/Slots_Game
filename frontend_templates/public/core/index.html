<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLOTS</title>
    <link rel="stylesheet" href="index.css">
</head>
<!-- position: fixed; height: 100vh; width: auto; -->
<body>
    <div style="position: fixed; display: flex; justify-content: center; align-items: center; height: 100vh; width: auto;">
        <div class="slots" style="display: flex; justify-content: center;">
            <div class="reel"></div>
            <div class="reel"></div>
            <div class="reel"></div>
        </div>

        <!-- <img style=""
            src="../images/rool.jpg" alt="images"> -->
        <!-- Agregar un botón para iniciar el giro -->
        <!--   <button
            style="display: flex; justify-items: center; justify-content: center; margin-left: auto; margin-right: auto; margin-top: 2rem; padding: 4px;"
            id="spinButton">Girar</button> -->
    </div>
    <script src="compiled.js"></script>
    <script>
        let clicksLeft = 3;//limite de giros
        let outcomes = []; // Arreglo para almacenar los resultados aleatorios de ganar o no ganar
        let hasWinner = false; // Variable para marcar si ya salió el ganador

        // Al cargar la página, inicializa los rodillos con índices aleatorios
        window.onload = () => {
            initRandom()
            generateRandomOutcomes()
        };

        window.addEventListener('message', (event) => {
            if (event.data.type === 'SPIN') {
                console.log('evento data', event.data.data)
                spinReels(event.data.data);
                /*    generateRandomOutcomes() */
                sendUpdateToReact()
                console.log('esta tomando bien el button')
            }
        });


        function sendUpdateToReact() {
            window.parent.postMessage({
                type: 'UPDATE_STATE',
                data: { clicksLeft, outcomes, hasWinner }
            }, '*')
        }


        // Genera un orden aleatorio para ganar/perder en 3 giros
        function generateRandomOutcomes() {
            outcomes = [false, false, true]; // Dos perdedores y un ganador
            for (let i = outcomes.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [outcomes[i], outcomes[j]] = [outcomes[j], outcomes[i]]; // Mezclar aleatoriamente los resultados
            }
        }
        // Agregar un evento de clic al botón para llamar a la función rollAll
        function spinReels(index) {
            if (clicksLeft <= 0) {
                console.log('no se puede jugar')
                return
            }
            clicksLeft--;
            const currentOutcome = outcomes[3 - clicksLeft - 1];
            console.log('current', currentOutcome)
            if (currentOutcome) {//si es verdadero que ya puede ganar
                const winIndexes = [index, index, index]
                rollAll(true, winIndexes)
            }
            else {
                const nonWinningIndexes = getNonRepeatingIndexes();
                console.log('valores erroneos para que no gane', nonWinningIndexes)
                rollAll(false, nonWinningIndexes);
            }
        };

        function getNonRepeatingIndexes() {
            const maxIndex = 8; // Define el rango máximo de los índices (0 al 8)
            const availableIndexes = Array.from({ length: maxIndex }, (_, i) => i); // Genera un arreglo de índices [0, 1, 2, ..., maxIndex - 1]
            // Mezclar los índices para obtener una lista aleatoria
            for (let i = availableIndexes.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [availableIndexes[i], availableIndexes[j]] = [availableIndexes[j], availableIndexes[i]];
            }
            console.log(availableIndexes)
            return availableIndexes.slice(0, 3); // Retorna los primeros tres índices aleatorios y diferentes
        }

        /*    // Ejemplo de uso:
           const outcome = randomOutcome();
           console.log(outcome); // Puede ser true o false, pero si es false en las dos primeras, será true en la última. */

    </script>
</body>

</html>